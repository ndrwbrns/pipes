var e=new THREE.Box3(new THREE.Vector3(-10,-10,-10),new THREE.Vector3(10,10,10)),t={};function n(e,n){t["("+e.x+", "+e.y+", "+e.z+")"]=n}function i(e,n){return t["("+e.x+", "+e.y+", "+e.z+")"]}function r(){t={}}var o={},a=function(t,r){var a=this,l=.2,c=1.5*l,h=c;if(a.currentPosition=K(e),a.positions=[a.currentPosition],a.object3d=new THREE.Object3D,t.add(a.object3d),r.texturePath)a.material=new THREE.MeshLambertMaterial({map:o[r.texturePath]});else{var d=D(0,16777215),u=new THREE.Color(d).multiplyScalar(.3);a.material=new THREE.MeshPhongMaterial({specular:11140351,color:d,emissive:u,shininess:100})}var s=function(e){var t=new THREE.Mesh(new THREE.SphereGeometry(c,8,8),a.material);t.position.copy(e),a.object3d.add(t)};n(a.currentPosition,a),s(a.currentPosition),a.update=function(){if(a.positions.length>1)var t=a.positions[a.positions.length-2],o=(new THREE.Vector3).subVectors(a.currentPosition,t);if(N(.5)&&o)var c=o;else(c=new THREE.Vector3)[F("xyz")]+=F([1,-1]);var d,u,E,w,m,p,f,v,R,H,T,g=(new THREE.Vector3).addVectors(a.currentPosition,c);e.containsPoint(g)&&(i(g)||(n(g,a),o&&!o.equals(c)&&(N(r.teapotChance)?(E=a.currentPosition,(w=new THREE.Mesh(new THREE.TeapotBufferGeometry(h,!0,!0,!0,!0,!0),a.material)).position.copy(E),w.rotation.x=Math.floor(q(0,50))*Math.PI/2,w.rotation.y=Math.floor(q(0,50))*Math.PI/2,w.rotation.z=Math.floor(q(0,50))*Math.PI/2,a.object3d.add(w)):N(r.ballJointChance)?s(a.currentPosition):(d=a.currentPosition,(u=new THREE.Mesh(new THREE.SphereGeometry(l,8,8),a.material)).position.copy(d),a.object3d.add(u))),m=a.currentPosition,p=g,f=a.material,v=(new THREE.Vector3).subVectors(p,m),R=new THREE.ArrowHelper(v.clone().normalize(),m),H=new THREE.CylinderGeometry(l,l,v.length(),10,4,!0),(T=new THREE.Mesh(H,f)).rotation.setFromQuaternion(R.quaternion),T.position.addVectors(m,v.multiplyScalar(.5)),T.updateMatrix(),a.object3d.add(T),a.currentPosition=g,a.positions.push(g)))}},l="elbow",c="ball",h="mixed",d="cycle",u=[l,c,h],s=0,E=document.getElementById("joint-types"),w=[],m={multiple:!0,texturePath:null,joints:E.value,interval:[16,24]};E.addEventListener("change",(function(){m.joints=E.value}));var p=document.getElementById("canvas-container"),f=document.getElementById("canvas-2d"),v=f.getContext("2d"),R=document.getElementById("canvas-webgl"),H=new THREE.WebGLRenderer({alpha:!0,antialias:!0,canvas:R});H.setSize(window.innerWidth,window.innerHeight);var T=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,1e5),g=new THREE.OrbitControls(T,H.domElement);g.enabled=!1;var x=new THREE.Scene,M=new THREE.AmbientLight(1118481);x.add(M);var y=new THREE.DirectionalLight(16777215,.9);y.position.set(-1.2,1.5,.5),x.add(y);var P,b=[],j=-1,S=50,I=50,V=2,W=60*V;function A(e,t){S=Math.ceil(window.innerWidth/20),I=Math.ceil(window.innerHeight/20),Q(b=new Array(S*I).fill(null).map((function(e,t){return{x:t%S,y:Math.floor(t/S)}}))),j=0,W=60*(V=e),P=t}function C(){P(),b=[],j=-1,v.clearRect(0,0,f.width,f.height)}var L=!1,z=-1;function B(e){(clearTimeout(z),z=setTimeout(B,1e3*q(m.interval[0],m.interval[1])),L)||(L=!0,A(e?.2:2,U))}function U(){H.clear();for(var e=0;e<w.length;e++)x.remove(w[e].object3d);w=[],r(),J(),L=!1}function G(){(g.update(),m.texturePath&&!o[m.texturePath])&&((n=THREE.ImageUtils.loadTexture(m.texturePath)).wrapS=n.wrapT=THREE.RepeatWrapping,n.repeat.set(2,2),o[m.texturePath]=n);for(var e=0;e<w.length;e++)w[e].update(x);if(0===w.length){var t=m.joints;m.joints===d&&(t=u[s++]);var n,i={teapotChance:.005,ballJointChance:t===c?1:t===h?1/3:0,texturePath:m.texturePath};if(N(.05))if(i.teapotChance=.05,i.texturePath="images/textures/candycane.png",!o[i.texturePath])(n=THREE.ImageUtils.loadTexture(i.texturePath)).wrapS=n.wrapT=THREE.RepeatWrapping,n.repeat.set(2,2),o[i.texturePath]=n;for(e=0;e<1+m.multiple*(1+N(.1));e++)w.push(new a(x,i))}if(L||H.render(x,T),(f.width!==window.innerWidth||f.height!==window.innerHeight)&&(f.width=window.innerWidth,f.height=window.innerHeight,j>-1))for(e=0;e<j;e++){var r=b[e],l=innerWidth/S,E=innerHeight/I;v.fillStyle="black",v.fillRect(Math.floor(r.x*l),Math.floor(r.y*E),Math.ceil(l),Math.ceil(E))}if(j>-1){var p=Math.floor(b.length/W);for(e=0;e<p&&j<b.length;e++){r=b[j],l=innerWidth/S,E=innerHeight/I;v.fillStyle="black",v.fillRect(Math.floor(r.x*l),Math.floor(r.y*E),Math.ceil(l),Math.ceil(E)),j+=1}j===b.length&&C()}requestAnimationFrame(G)}function J(){var e=new THREE.Vector3(14,0,0),t=new THREE.Vector3(q(-1,1),q(-1,1),q(-1,1)),n=Math.PI/2,i=(new THREE.Matrix4).makeRotationAxis(t,n);e.applyMatrix4(i),T.position.copy(e)}z=setTimeout(B,1e3*q(m.interval[0],m.interval[1]));var O=new THREE.Vector3(0,0,0);function k(){var e=decodeURIComponent(location.hash.replace(/^#/,""));if(e)try{var t=JSON.parse(e);"object"!=typeof t&&(alert("Invalid URL parameter JSON: top level value must be an object"),t=null)}catch(t){alert("Invalid URL parameter JSON syntax\n\n"+t+"\n\nRecieved:\n"+e)}X(".ui-container",!(t=t||{}).hideUI)}function q(e,t){return Math.random()*(t-e)+e}function D(e,t){return Math.round(q(e,t))}function N(e){return Math.random()<e}function F(e){return e[Math.floor(Math.random()*e.length)]}function Q(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[n],e[n]=i}}function K(e){return new THREE.Vector3(D(e.min.x,e.max.x),D(e.min.y,e.max.y),D(e.min.z,e.max.z))}function X(e,t){Array.from(document.querySelectorAll(e)).forEach((function(e){t?e.removeAttribute("hidden"):e.setAttribute("hidden","hidden")}))}T.lookAt(O),g.update(),J(),addEventListener("resize",(function(){H.setSize(window.innerWidth,window.innerHeight),T.aspect=window.innerWidth/window.innerHeight,T.updateProjectionMatrix()}),!1),p.addEventListener("mousedown",(function(e){e.preventDefault(),g.enabled||(e.button?B(!0):J()),window.getSelection().removeAllRanges(),document.activeElement.blur()})),p.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),k(),window.addEventListener("hashchange",k),G();
