var e=new THREE.Box3(new THREE.Vector3(-10,-10,-10),new THREE.Vector3(10,10,10)),t={};function n(e,n){t["("+e.x+", "+e.y+", "+e.z+")"]=n}function i(e,n){return t["("+e.x+", "+e.y+", "+e.z+")"]}function r(){t={}}var o={},a=function(t,r){var a=this,l=.2,c=1.5*l,d=c;if(a.currentPosition=K(e),a.positions=[a.currentPosition],a.object3d=new THREE.Object3D,t.add(a.object3d),r.texturePath)a.material=new THREE.MeshLambertMaterial({map:o[r.texturePath]});else{var u=q(0,16777215),h=new THREE.Color(u).multiplyScalar(.3);a.material=new THREE.MeshPhongMaterial({specular:11140351,color:u,emissive:h,shininess:100})}var s=function(e){var t=new THREE.Mesh(new THREE.SphereGeometry(c,8,8),a.material);t.position.copy(e),a.object3d.add(t)};n(a.currentPosition,a),s(a.currentPosition),a.update=function(){if(a.positions.length>1)var t=a.positions[a.positions.length-2],o=(new THREE.Vector3).subVectors(a.currentPosition,t);if(N(.5)&&o)var c=o;else(c=new THREE.Vector3)[F("xyz")]+=F([1,-1]);var u,h,E,w,m,f,p,v,R,H,g,T=(new THREE.Vector3).addVectors(a.currentPosition,c);e.containsPoint(T)&&(i(T)||(n(T,a),o&&!o.equals(c)&&(N(r.teapotChance)?(E=a.currentPosition,(w=new THREE.Mesh(new THREE.TeapotBufferGeometry(d,!0,!0,!0,!0,!0),a.material)).position.copy(E),w.rotation.x=Math.floor(O(0,50))*Math.PI/2,w.rotation.y=Math.floor(O(0,50))*Math.PI/2,w.rotation.z=Math.floor(O(0,50))*Math.PI/2,a.object3d.add(w)):N(r.ballJointChance)?s(a.currentPosition):(u=a.currentPosition,(h=new THREE.Mesh(new THREE.SphereGeometry(l,8,8),a.material)).position.copy(u),a.object3d.add(h))),m=a.currentPosition,f=T,p=a.material,v=(new THREE.Vector3).subVectors(f,m),R=new THREE.ArrowHelper(v.clone().normalize(),m),H=new THREE.CylinderGeometry(l,l,v.length(),10,4,!0),(g=new THREE.Mesh(H,p)).rotation.setFromQuaternion(R.quaternion),g.position.addVectors(m,v.multiplyScalar(.5)),g.updateMatrix(),a.object3d.add(g),a.currentPosition=T,a.positions.push(T)))}},l="elbow",c="ball",d="mixed",u="cycle",h=[l,c,d],s=0,E=document.getElementById("joint-types"),w=[],m={multiple:!0,texturePath:null,joints:E.value,interval:[16,24]};E.addEventListener("change",(function(){m.joints=E.value}));var f=document.getElementById("canvas-container"),p=document.getElementById("canvas-2d"),v=p.getContext("2d"),R=document.getElementById("canvas-webgl"),H=new THREE.WebGLRenderer({alpha:!0,antialias:!0,canvas:R});H.setSize(window.innerWidth,window.innerHeight);var g=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,1e5),T=new THREE.OrbitControls(g,H.domElement);T.enabled=!1;var x=new THREE.Scene,M=new THREE.AmbientLight(1118481);x.add(M);var y=new THREE.DirectionalLight(16777215,.9);y.position.set(-1.2,1.5,.5),x.add(y);var b,P=[],S=-1,j=50,I=50,V=2,A=60*V;function L(e,t){j=Math.ceil(window.innerWidth/20),I=Math.ceil(window.innerHeight/20),Q(P=new Array(j*I).fill(null).map((function(e,t){return{x:t%j,y:Math.floor(t/j)}}))),S=0,A=60*(V=e),b=t}function W(){b(),P=[],S=-1,v.clearRect(0,0,p.width,p.height)}var C=!1,z=-1;function B(e){(clearTimeout(z),z=setTimeout(B,1e3*O(m.interval[0],m.interval[1])),C)||(C=!0,L(e?.2:2,U))}function U(){H.clear();for(var e=0;e<w.length;e++)x.remove(w[e].object3d);w=[],r(),D(),C=!1}function k(){(T.update(),m.texturePath&&!o[m.texturePath])&&((n=THREE.ImageUtils.loadTexture(m.texturePath)).wrapS=n.wrapT=THREE.RepeatWrapping,n.repeat.set(2,2),o[m.texturePath]=n);for(var e=0;e<w.length;e++)w[e].update(x);if(0===w.length){var t=m.joints;m.joints===u&&(t=h[s++]);var n,i={teapotChance:.005,ballJointChance:t===c?1:t===d?1/3:0,texturePath:m.texturePath};if(N(.05))if(i.teapotChance=.05,i.texturePath="images/textures/candycane.png",!o[i.texturePath])(n=THREE.ImageUtils.loadTexture(i.texturePath)).wrapS=n.wrapT=THREE.RepeatWrapping,n.repeat.set(2,2),o[i.texturePath]=n;for(e=0;e<1+m.multiple*(1+N(.1));e++)w.push(new a(x,i))}if(C||H.render(x,g),(p.width!==window.innerWidth||p.height!==window.innerHeight)&&(p.width=window.innerWidth,p.height=window.innerHeight,S>-1))for(e=0;e<S;e++){var r=P[e],l=innerWidth/j,E=innerHeight/I;v.fillStyle="black",v.fillRect(Math.floor(r.x*l),Math.floor(r.y*E),Math.ceil(l),Math.ceil(E))}if(S>-1){var f=Math.floor(P.length/A);for(e=0;e<f&&S<P.length;e++){r=P[S],l=innerWidth/j,E=innerHeight/I;v.fillStyle="black",v.fillRect(Math.floor(r.x*l),Math.floor(r.y*E),Math.ceil(l),Math.ceil(E)),S+=1}S===P.length&&W()}requestAnimationFrame(k)}function D(){var e=new THREE.Vector3(14,0,0),t=new THREE.Vector3(O(-1,1.5,1),O(-1,1.5,1),O(-1,1.5,1)),n=Math.PI/2,i=(new THREE.Matrix4).makeRotationAxis(t,n);e.applyMatrix4(i),g.position.copy(e)}z=setTimeout(B,1e3*O(m.interval[0],m.interval[1]));var G=new THREE.Vector3(0,0,0);function J(){var e=decodeURIComponent(location.hash.replace(/^#/,""));if(e)try{var t=JSON.parse(e);"object"!=typeof t&&(alert("Invalid URL parameter JSON: top level value must be an object"),t=null)}catch(t){alert("Invalid URL parameter JSON syntax\n\n"+t+"\n\nRecieved:\n"+e)}X(".ui-container",!(t=t||{}).hideUI)}function O(e,t){return Math.random()*(t-e)+e}function q(e,t){return Math.round(O(e,t))}function N(e){return Math.random()<e}function F(e){return e[Math.floor(Math.random()*e.length)]}function Q(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[n],e[n]=i}}function K(e){return new THREE.Vector3(q(e.min.x,e.max.x),q(e.min.y,e.max.y),q(e.min.z,e.max.z))}function X(e,t){Array.from(document.querySelectorAll(e)).forEach((function(e){t?e.removeAttribute("hidden"):e.setAttribute("hidden","hidden")}))}g.lookAt(G),T.update(),D(),addEventListener("resize",(function(){H.setSize(window.innerWidth,window.innerHeight),g.aspect=window.innerWidth/window.innerHeight,g.updateProjectionMatrix()}),!1),f.addEventListener("click",(function(e){e.preventDefault(),T.enabled||(e.button?B(!0):D()),window.getSelection().removeAllRanges(),document.activeElement.blur()})),f.addEventListener("mousedown",(function(e){e.preventDefault(),T.enabled||(e.button?B(!0):D()),window.getSelection().removeAllRanges(),document.activeElement.blur()})),f.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),J(),window.addEventListener("hashchange",J),k();
